(window.webpackJsonp=window.webpackJsonp||[]).push([[268],{694:function(s,t,e){"use strict";e.r(t);var _=e(6),v=Object(_.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),t("p",[s._v("下文的操作均在ubuntu上进行.")])]),s._v(" "),t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[t("strong",[s._v("最近刚把腾讯云服务器搭建好,就发现访问时间异常的长,觉得不应该呀,意识到可能是服务器遭受到攻击.")])]),s._v(" "),t("p",[s._v("于是登录服务器打开"),t("code",[s._v("/var/log/auth.log")]),s._v("下的访问日志,果然有大量的非法ip访问")]),s._v(" "),t("blockquote",[t("ul",[t("li",[s._v("...")]),s._v(" "),t("li",[s._v("May 25 13:57:49 localhost sshd[27673]: Invalid user test9 from 128.199.30.172 port 51386")]),s._v(" "),t("li",[s._v("May 25 13:57:49 localhost sshd[27673]: pam_unix(sshd:auth): check pass; user unknown")]),s._v(" "),t("li",[s._v("May 25 13:57:49 localhost sshd[27673]: pam_unix(sshd:auth): authentication failure; logname= uid=0 euid=0 tty=ssh ruser= rhost=128.199.30.172")]),s._v(" "),t("li",[s._v("May 25 13:57:51 localhost sshd[27673]: Failed password for invalid user test9 from 128.199.30.172 port 51386 ssh2")]),s._v(" "),t("li",[s._v("May 25 13:57:51 localhost sshd[27673]: Received disconnect from 128.199.30.172 port 51386:11: Bye Bye [preauth]")]),s._v(" "),t("li",[s._v("May 25 13:57:51 localhost sshd[27673]: Disconnected from invalid user test9 128.199.30.172 port 51386 [preauth]")]),s._v(" "),t("li",[s._v("May 25 13:58:01 localhost CRON[27700]: pam_unix(cron:session): session opened for user root by (uid=0)")]),s._v(" "),t("li",[s._v("May 25 13:58:01 localhost CRON[27700]: pam_unix(cron:session): session closed for user root")]),s._v(" "),t("li",[s._v("May 25 13:58:06 localhost sshd[27651]: Connection closed by 20.194.166.160 port 54602 [preauth]")]),s._v(" "),t("li",[s._v("May 25 13:58:24 localhost sshd[27787]: Invalid user ec2-user from 117.79.132.166 port 38400")]),s._v(" "),t("li",[s._v("...")])])]),s._v(" "),t("p",[s._v("这是才想到服务器自从搭建后,系统的配置都是默认的包括SSH(安全外壳协议),也难怪遭受到了攻击.")]),s._v(" "),t("p",[s._v("于是想到了对SSH配置")]),s._v(" "),t("h2",{attrs:{id:"_1-修改ssh配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-修改ssh配置"}},[s._v("#")]),s._v(" 1.修改SSH配置")]),s._v(" "),t("h3",{attrs:{id:"_1-禁止root账号远程登录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-禁止root账号远程登录"}},[s._v("#")]),s._v(" (1).禁止root账号远程登录")]),s._v(" "),t("p",[s._v("root账号是系统默认的账号,且拥有最高的权限,攻击者在攻击的时候,也会首先选择root进行攻击,\n才看日志也发现user root的最多")]),s._v(" "),t("p",[s._v("首先我们进入到"),t("code",[s._v("/etc/ssh")]),s._v("目录面,打开"),t("code",[s._v("sshd_config")]),s._v("文件,将PermitRootLogin设置为no\n"),t("RouterLink",{attrs:{to:"/pages/9f8acb/"}},[s._v("关于ubuntu账户的创建可以查看")])],1),s._v(" "),t("h3",{attrs:{id:"_2-修改端口"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-修改端口"}},[s._v("#")]),s._v(" (2).修改端口")]),s._v(" "),t("p",[s._v("服务器默认的的端口Port是22,建议不定时修改一下.")]),s._v(" "),t("Badge",{attrs:{text:"注",type:"error",vertical:"middle"}}),s._v(":端口最大只能修改到65536,注意不要超过\n"),t("p",[s._v("修改SSH配置后,重启SSH"),t("code",[s._v("sudo service sshd restart")])]),s._v(" "),t("h2",{attrs:{id:"_2-配置ip访问黑白名单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置ip访问黑白名单"}},[s._v("#")]),s._v(" 2.配置IP访问黑白名单")]),s._v(" "),t("p",[s._v("进入"),t("code",[s._v("/etc")]),s._v("文件下有"),t("code",[s._v("hosts.allow")]),s._v("和"),t("code",[s._v("hosts.deny")]),s._v("两个文件,分别是填写允许和禁止IP的")]),s._v(" "),t("p",[t("strong",[s._v("(1).允许某一个IP")])]),s._v(" "),t("p",[s._v("允许shh远程协议的:"),t("code",[s._v("hosts.allow")]),s._v("中填写"),t("code",[s._v("sshd:192.168.0.1")])]),s._v(" "),t("p",[s._v("允许telnet远程协议的:"),t("code",[s._v("hosts.allow")]),s._v("中填写"),t("code",[s._v("in.telnetd:192.168.0.1")])]),s._v(" "),t("p",[s._v("允许所有远程协议的:"),t("code",[s._v("hosts.allow")]),s._v("中填写"),t("code",[s._v("ALL:192.168.0.1")])]),s._v(" "),t("p",[t("strong",[s._v("(2).允许某一个IP段")])]),s._v(" "),t("p",[s._v("允许shh远程协议的:"),t("code",[s._v("hosts.allow")]),s._v("中填写"),t("code",[s._v("sshd:192.168.0")])]),s._v(" "),t("p",[s._v("允许telnet远程协议的:"),t("code",[s._v("hosts.allow")]),s._v("中填写"),t("code",[s._v("in.telnetd:192.168.0")])]),s._v(" "),t("p",[s._v("允许所有远程协议的:"),t("code",[s._v("hosts.allow")]),s._v("中填写"),t("code",[s._v("ALL:192.168.0")])]),s._v(" "),t("p",[t("strong",[s._v("(3).禁止所有IP")])]),s._v(" "),t("p",[s._v("允许shh远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("sshd:ALL")])]),s._v(" "),t("p",[s._v("允许telnet远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("in.telnetd:ALL")])]),s._v(" "),t("p",[s._v("允许所有远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("ALL:ALL")])]),s._v(" "),t("p",[t("strong",[s._v("(4).禁止某一个ip")])]),s._v(" "),t("p",[s._v("允许shh远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("sshd:192.168.0.1")])]),s._v(" "),t("p",[s._v("允许telnet远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("in.telnetd:192.168.0.1")])]),s._v(" "),t("p",[s._v("允许所有远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("ALL:192.168.0.1")])]),s._v(" "),t("p",[t("strong",[s._v("(4).禁止某一个ip段")])]),s._v(" "),t("p",[s._v("允许shh远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("sshd:192.168.0")])]),s._v(" "),t("p",[s._v("允许telnet远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("in.telnetd:192.168.0")])]),s._v(" "),t("p",[s._v("允许所有远程协议的:"),t("code",[s._v("hosts.deny")]),s._v("中填写"),t("code",[s._v("ALL:192.168.0")])]),s._v(" "),t("p",[s._v("另外还可以使用")]),s._v(" "),t("p",[t("code",[s._v("sshd : ALL EXCEPT 111.111.111.0/255.255.255.0 222.222.222.222 333.333.333.0/255.255.255.0")])]),s._v(" "),t("p",[s._v("就是允许222.222.222.222固定IP和111.111.111.0和333.333.333.0 IP段访问")]),s._v(" "),t("p",[s._v("重启 "),t("code",[s._v("service sshd restart")]),s._v("和 "),t("code",[s._v("service xinetd restart")])]),s._v(" "),t("Badge",{attrs:{text:"注",type:"error",vertical:"middle"}}),s._v(":hosts.allow和hosts.deny冲突时候,以hosts.allow为准\n"),t("h2",{attrs:{id:"_3-netfilter-iptables封禁ip"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-netfilter-iptables封禁ip"}},[s._v("#")]),s._v(" 3.netfilter/iptables封禁IP")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[s._v("`sudo iptables -A INPUT -s 1.1.1.1 -p TCP -j DROP `封禁多次恶意访问的IP\n")])])]),t("p",[t("code",[s._v("netfilter/iptables")]),s._v("具体操作参考:\n"),t("a",{attrs:{href:"https://linux.cn/article-4904-1.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客"),t("OutboundLink")],1),s._v(" "),t("a",{attrs:{href:"https://www.cnblogs.com/TDXYBS/p/10944748.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("博客"),t("OutboundLink")],1)])],1)}),[],!1,null,null,null);t.default=v.exports}}]);